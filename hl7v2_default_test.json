{
  "parser_settings": {
    "version": "omni.2.1",
    "file_format_type": "edi"
  },
  "file_declaration": {
    "segment_delimiter": "\\r",
    "element_delimiter": "|",
    "component_delimiter": "^",
    "segment_declarations": [
      {
        "name": "patient",
        "type": "segment_group",
        "is_target": true,
        "child_segments": [
        {"name": "MSH",
            "elements": [
                {"name": "sending_facility", "index": 3},
                {"name": "datetime_of_message", "index": 6},
                {"name": "message_trigger", "index": 8},
                {"name": "message_control_id", "index": 9}
            ]
        },
        {"name": "SFT", "min": 0, "max": -1},
        {"name": "EVN",
            "min": 0,
            "elements": [
                {"name": "message_typecode", "index": 1}
            ]
        },
        {"name": "PID",
            "min": 0,
            "elements": [
                {"name": "set_id", "index": 1, "component_index": 1, "default": "1"},
                {"name": "mrn", "index": 3, "component_index": 1, "default": ""},
                {"name": "last_name", "index": 5, "component_index": 1, "default": ""},
                {"name": "first_name", "index": 5, "component_index": 2, "default": ""},
                {"name": "middle_name", "index": 5, "component_index": 3, "default": ""},
                {"name": "dob", "index": 7, "component_index": 1, "default": ""},
                {"name": "gender", "index": 8, "default": "Unknown"},
                {"name": "address_1", "index": 11, "component_index": 1, "default": ""},
                {"name": "address_2", "index": 11, "component_index": 2, "default": ""},
                {"name": "city", "index": 11, "component_index": 3, "default": ""},
                {"name": "state", "index": 11, "component_index": 4, "default": ""},
                {"name": "zip", "index": 11, "component_index": 5, "default": ""},
                {"name": "country", "index": 11, "component_index": 6, "default": ""},
                {"name": "address_type", "index": 11, "component_index": 7, "default": "H"},
                {"name": "home_phone", "index": 13, "component_index": 1, "default": ""},
                {"name": "home_phone_type", "index": 13, "component_index": 3, "default": ""},
                {"name": "home_email", "index": 13, "component_index": 4, "default": ""},
                {"name": "work_phone", "index": 14, "component_index": 1, "default": ""},
                {"name": "work_phone_type", "index": 14, "component_index": 3, "default": ""},
                {"name": "work_email", "index": 14, "component_index": 4, "default": ""},
                {"name": "marital_status", "index": 16, "default": "Unknown"},
                {"name": "hospital_patient_number", "index": 18, "component_index": 1, "default": ""},
                {"name": "ssn", "index": 19, "default": ""},
                {"name": "multiple_birth", "index": 24, "default": ""},
                {"name": "date_of_death", "index": 29, "component_index": 1, "default": ""},
                {"name": "birth_order", "index": 25, "default": ""},
                {"name": "admit_date", "index": 44, "default": ""},
                {"name": "discharge_date", "index": 45, "default": ""}
            ]
        },
        {"name": "NTE","min": 0, "max": -1},
        {"name": "ZPD","min": 0, "max": -1},
        {"name": "PD1","min": 0, "max": -1},
        {"name": "NTE","min": 0, "max": -1},
        {"name": "ZPI","min": 0, "max": -1},
        {"name": "ZEI","min": 0, "max": -1},
        {"name": "MRG","min": 0, "max": -1},
        {"name": "ROL","min": 0, "max": -1},
        {"name": "CON","min": 0, "max": -1},
        {"name": "NK1","min": 0, "max": -1},
        {"name": "ZKI","min": 0, "max": -1},
        {"name": "PV1","min": 0,
            "elements": [
                {"name": "set_id", "index": 1, "component_index": 1, "default": "1"},
                {"name": "point_of_care", "index": 3, "component_index": 1, "default": ""},
                {"name": "admit_type", "index": 4, "default": ""},
                {"name": "attending_physician_id", "index": 7, "component_index": 1, "default": ""},
                {"name": "attending_physician_last_name", "index": 7, "component_index": 2, "default": ""},
                {"name": "attending_physician_first_name", "index": 7, "component_index": 3, "default": ""},
                {"name": "attending_physician_type_code", "index": 7, "component_index": 13, "default": ""},
                {"name": "referring_physician_id", "index": 8, "component_index": 1, "default": ""},
                {"name": "referring_physician_last_name", "index": 8, "component_index": 2, "default": ""},
                {"name": "referring_physician_first_name", "index": 8, "component_index": 3, "default": ""},
                {"name": "referring_physician_type_code", "index": 8, "component_index": 13, "default": ""},
                {"name": "patient_type", "index": 18, "default": ""},
                {"name": "financial_class", "index": 20, "component_index": 1, "default": ""},
                {"name": "admit_datetime", "index": 44, "default": ""},
                {"name": "discharge_datetime", "index": 45, "default": ""}
            ]
        },
        {"name": "PV2","min": 0, "max": -1},
        {"name": "PD1","min": 0, "max": -1},
        {"name": "ZPV","min": 0, "max": -1},
        {"name": "ZVI","min": 0, "max": -1},
        {"name": "ZIF","min": 0, "max": -1},
        {"name": "ZBE","min": 0, "max": -1},
        {"name": "NTE","min": 0, "max": -1},
        {"name": "ROL","min": 0, "max": -1},
        {"name": "DB1","min": 0, "max": -1},
        {"name": "OBX","min": 0, "max": -1},
        {"name": "NTE","min": 0, "max": -1},
        {"name": "allergy", "type":"segment_group","min": 0, "max": -1,
            "child_segments": [
                {"name": "AL1","min": 0,"max": -1},
                {"name": "ZAL","min": 0,"max": -1}
            ]
        },
        {"name": "ACC","min": 0, "max": -1},
        {"name": "DG1","min": 0, "max": -1},
        {"name": "DRG","min": 0},
        {"name": "procedure", "type": "segment_group","min": 0, "max": -1,
            "child_segments": [
                {"name": "PR1","min": 0, "max": -1},
                {"name": "ROL","min": 0}
            ]
        },
        {"name": "guarantor", "type":"segment_group","min": 0, "max": -1,
            "child_segments": [
                {
                    "name": "GT1","min": 0,
                    "elements": [
                        {"name": "set_id", "index": 1, "default": "1"},
                        {"name": "guarantor_number", "index": 2, "default": "00000"},
                        {"name": "last_name", "index": 3, "component_index": 1, "default": ""},
                        {"name": "first_name", "index": 3, "component_index": 2, "default": ""},
                        {"name": "middle_name", "index": 3, "component_index": 3, "default": ""},
                        {"name": "address_1", "index": 5, "component_index": 1, "default": ""},
                        {"name": "address_2", "index": 5, "component_index": 2, "default": ""},
                        {"name": "city", "index": 5, "component_index": 3, "default": ""},
                        {"name": "state", "index": 5, "component_index": 4, "default": ""},
                        {"name": "zip", "index": 5, "component_index": 5, "default": ""},
                        {"name": "country", "index": 5, "component_index": 6, "default": ""},
                        {"name": "address_type", "index": 5, "component_index": 7, "default": "H"},
                        {"name": "home_phone", "index": 6, "component_index": 1, "default": ""},
                        {"name": "home_phone_type", "index": 6, "component_index": 3, "default": ""},
                        {"name": "home_email", "index": 6, "component_index": 4, "default": ""},
                        {"name": "work_phone", "index": 7, "component_index": 1, "default": ""},
                        {"name": "work_phone_type", "index": 7, "component_index": 3, "default": ""},
                        {"name": "work_email", "index": 7, "component_index": 4, "default": ""},
                        {"name": "dob", "index": 8, "default": ""},
                        {"name": "gender", "index": 9, "default": "Unknown"},
                        {"name": "ssn", "index": 12, "default": ""},
                        {"name": "marital_status", "index": 30, "default": "Unknown"}
                    ]
                },
                {"name": "ZG1","min": 0, "max": -1},
                {"name": "ZGI","min": 0, "max": -1}
            ]
        },
        {"name": "insurance", "type":"segment_group","min": 0, "max": -1,
            "child_segments": [
                {
                    "name": "IN1",
                    "elements": [
                        {"name": "set_id", "index": 1, "default": "1"},
                        {"name": "plan_id", "index": 2, "component_index": 1, "default": "00000"},
                        {"name": "plan_name", "index": 2, "component_index": 2, "default": "00000"},
                        {"name": "company_id", "index": 3, "component_index": 1, "default": "00000"},
                        {"name": "company_name", "index": 4, "component_index": 1, "default": ""},
                        {"name": "address_1", "index": 5, "component_index": 1, "default": ""},
                        {"name": "address_2", "index": 5, "component_index": 2, "default": ""},
                        {"name": "city", "index": 5, "component_index": 3, "default": ""},
                        {"name": "state", "index": 5, "component_index": 4, "default": ""},
                        {"name": "zip", "index": 5, "component_index": 5, "default": ""},
                        {"name": "country", "index": 5, "component_index": 6, "default": ""},
                        {"name": "address_type", "index": 5, "component_index": 7, "default": ""},
                        {"name": "insurance_phone", "index": 7, "component_index": 1, "default": ""},
                        {"name": "insurance_phone_type", "index": 7, "component_index": 3, "default": ""},
                        {"name": "group_number", "index": 8, "default": "00000"},
                        {"name": "group_name", "index": 9, "default": "00000"},
                        {"name": "group_employer_id", "index": 10,  "component_index": 1, "default": ""},
                        {"name": "group_employer_name", "index": 11,  "component_index": 1, "default": ""},
                        {"name": "plan_effective_date", "index": 12, "default": ""},
                        {"name": "plan_expiration_date", "index": 13, "default": ""},
                        {"name": "auth_number", "index": 14,  "component_index": 1, "default": ""},
                        {"name": "auth_date", "index": 14,  "component_index": 2, "default": ""},
                        {"name": "plan_type", "index": 15, "default": ""},
                        {"name": "insured_last_name", "index": 16, "component_index": 1, "default": ""},
                        {"name": "insured_first_name", "index": 16, "component_index": 2, "default": ""},
                        {"name": "insured_middle_name", "index": 16, "component_index": 3, "default": ""},
                        {"name": "insured_patient_relationship", "index": 17, "component_index": 1, "default": ""},
                        {"name": "insured_dob", "index": 18, "default": ""},
                        {"name": "insured_address_1", "index": 19, "component_index": 1, "default": ""},
                        {"name": "insured_address_2", "index": 19, "component_index": 2, "default": ""},
                        {"name": "insured_city", "index": 19, "component_index": 3, "default": ""},
                        {"name": "insured_state", "index": 19, "component_index": 4, "default": ""},
                        {"name": "insured_zip", "index": 19, "component_index": 5, "default": ""},
                        {"name": "insured_country", "index": 19, "component_index": 6, "default": ""},
                        {"name": "insured_address_type", "index": 19, "component_index": 7, "default": "H"},
                        {"name": "policy_number", "index": 36, "default": ""},
                        {"name": "insured_gender", "index": 43, "default": ""}
                    ]
                },
                {
                    "name": "IN2", "min": 0,
                    "elements": [
                        {"name": "insured_ssn", "index": 2, "default": ""},
                        {"name": "insured_home_phone", "index": 63, "component_index": 1, "default": ""},
                        {"name": "insured_home_phone_type", "index": 63, "component_index": 3, "default": ""},
                        {"name": "insured_home_email", "index": 63, "component_index": 4, "default": ""},
                        {"name": "insured_work_phone", "index": 64, "component_index": 1, "default": ""},
                        {"name": "insured_work_phone_type", "index": 64, "component_index": 3, "default": ""},
                        {"name": "insured_work_email", "index": 64, "component_index": 4, "default": ""}
                    ]
                },
                {"name": "ZNI","min": 0,"max": -1},
                {"name": "IN3","min": 0,"max": -1},
                {"name": "ROL","min": 0,"max": -1},
                {"name": "ZIN","min": 0,"max": -1},
                {"name": "ZN3","min": 0,"max": -1}
            ]
        },
        {"name": "DG1","min": 0, "max": -1},
        {"name": "AL1","min": 0, "max": -1},
        {"name": "PR1","min": 0, "max": -1},
        {"name": "ACC","min": 0, "max": -1},
        {"name": "UB1","min": 0, "max": -1},
        {"name": "UB2","min": 0, "max": -1},
        {"name": "ACC","min": 0, "max": -1},
        {"name": "PDA","min": 0, "max": -1},
        {"name": "ZMR","min": 0, "max": -1},
        {"name": "ZCD","min": 0, "max": -1},
        {"name": "ZIN","min": 0, "max": -1},
        {"name": "ZIM","min": 0, "max": -1},
        {"name": "ZCN","min": 0, "max": -1},
        {"name": "ZCS","min": 0, "max": -1},
        {"name": "ZM1","min": 0, "max": -1},
        {"name": "ZPV","min": 0, "max": -1},
        {"name": "ZEX","min": 0, "max": -1},
        {"name": "ZRE","min": 0, "max": -1},
        {"name": "ZQA","min": 0, "max": -1}
        ]
      }
    ]
  },
  "transform_declarations": {
    "FINAL_OUTPUT": {
      "object": {
        "resourceType": {"const": "Bundle"},
        "id": {"const": "aa948bbf-a76a-48e2-845c-cccccb93ca4d"},
        "type": {"const": "transaction"},
        "entry": {
          "array": [
            {"template": "messageheader_resource"},
            {"template": "organization_facility_resource"},
            {"xpath": ".[count(PID)=1]", "template": "patient_resource"},
            {"xpath": ".[count(PV1)=1]", "template": "encounter_resource"},
            {"xpath": ".[EVN/message_typecode!='A40']","template": "account_resource"},
            {"xpath": ".[PV1/point_of_care!='']","template": "organization_department_resource"},
            {"xpath": ".[PV1/attending_physician_id!='']", "template": "practitioner_attending_resource"},
            {"xpath": ".[PV1/referring_physician_id!='']", "template": "practitioner_referring_resource"},
            {"xpath": "guarantor[position()=1]", "template": "relatedperson_guarantor_resource"},
            {"xpath": "guarantor[position()=2]", "template": "relatedperson_guarantor_resource"},
            {"xpath": "insurance[position()=1]", "template": "organization_payor_resource", "_comment": "resource for Organization of primary Payer, if found"},
            {"xpath": "insurance[position()=1]", "template": "coverage_resource", "_comment": "resource for Primary Coverage 1st insurance instance found"},
            {"xpath": "insurance[position()=1][//insurance[position()=1]/IN1/insured_patient_relationship[translate(text(), 'abcdefghijklmnopqrstuvwxyz','ABCDEFGHIJKLMNOPQRSTUVWXYZ')][not(.='SELF') and not(.='01') and not(.='S') and not(.='SP') and not(.='SE')]]", "template": "relatedperson_subscriber_resource", "_comment": "relatedperson resource for subscriber will be generated IFF insured patient relationship (IN1.17) is NOT 'SELF'"},
            {"xpath": "insurance[position()=1][//insurance[position()=1]/IN1/auth_number!='']", "template": "claim_resource", "_comment": "resource for preauth if found for primary insurance"},
            {"xpath": "insurance[position()=2]", "template": "organization_payor_resource", "_comment": "resource for Organization of secondary Payer, if found"},
            {"xpath": "insurance[position()=2]", "template": "coverage_resource", "_comment": "resource for Secondary Coverage 2nd insurance instance found"},
            {"xpath": "insurance[position()=2][//insurance[position()=2]/IN1/insured_patient_relationship[translate(text(), 'abcdefghijklmnopqrstuvwxyz','ABCDEFGHIJKLMNOPQRSTUVWXYZ')][not(.='SELF') and not(.='01') and not(.='S') and not(.='SP') and not(.='SE')]]", "template": "relatedperson_subscriber_resource", "_comment": "relatedperson resource for subscriber will be generated IFF insured patient relationship (IN1.17) is NOT 'SELF'"},
            {"xpath": "insurance[position()=2][//insurance[position()=2]/IN1/auth_number!='']", "template": "claim_resource", "_comment": "resource for preauth if found for secondary insurance"},
            {"xpath": "insurance[position()=3]", "template": "organization_payor_resource", "_comment": "resource for Organization of tertiary Payer, if found"},
            {"xpath": "insurance[position()=3]", "template": "coverage_resource", "_comment": "resource for Tertiary Coverage 3rd insurance instance found"},
            {"xpath": "insurance[position()=3][//insurance[position()=3]/IN1/insured_patient_relationship[translate(text(), 'abcdefghijklmnopqrstuvwxyz','ABCDEFGHIJKLMNOPQRSTUVWXYZ')][not(.='SELF') and not(.='01') and not(.='S') and not(.='SP') and not(.='SE')]]", "template": "relatedperson_subscriber_resource", "_comment": "relatedperson resource for subscriber will be generated IFF insured patient relationship (IN1.17) is NOT 'SELF'"},
            {"xpath": "insurance[position()=3][//insurance[position()=3]/IN1/auth_number!='']", "template": "claim_resource", "_comment": "resource for preauth if found for tertiary insurance"}
          ]
        }
      }
    },
    "messageheader_resource": {
      "object": {
        "fullUrl": {"const": "urn:uuid:11ebe121-cfdc-4613-9bf2-983a382c0001"},
        "resource": {
          "object": {
            "resourceType": {"const": "MessageHeader"},
            "extension": {
              "array": [
                {
                  "object": {
                    "url": {"const": "https://smilecdr.com/fhir/ns/StructureDefinition/messageheader-source-message-id"},
                    "valueString": {"template": "transform_message_header_control_id"}
                  }
                }
              ]
            },
            "eventCoding": {
              "object": {
                "system": {"const": "http://terminology.hl7.org/CodeSystem/v2"},
                "code": {"xpath": "EVN/message_typecode"}
              }
            },
            "sender": {
              "object": {
                "identifier": {
                  "object": {
                    "system": {"const": "http://abc.com2"},
                    "value": {"const": "sender"}
                  }
                }
              }
            },
            "focus": {
              "array": [
                {
                  "object": {
                    "reference": {"xpath":".", "template": "transform_message_header_focus"}
                  }
                }
              ]
            },
            "source": {
              "object": {
                "name": {"const": "SourceApp"},
                "endpoint": {"const": "SourceApp"}
              }
            }
          }
        },
        "request": {
          "object": {
            "method": {"const": "PUT"},
            "url": {"template": "transform_message_header_identifier"}
          }
        }
      }
    },
    "organization_facility_resource": {
      "object": {
        "fullUrl": {"const": "urn:uuid:61ebe121-aa02-0001-0001-983a382abcd7"},
        "resource": {
          "object": {
            "resourceType": {"const": "Organization"},
            "identifier": {
              "array": [
                {
                  "object": {
                    "system": {"const": "https://pediatrix.com/fhir/NamingSystem/facilityId-id"},
                    "value": {"const": "{{FacilityId}}"}
                  }
                }
              ]
            }
          }
        },
        "request": {
          "object": {
            "method": {"const": "POST"},
            "url": {"const": "Organization"},
            "ifNoneExist": {"template": "organization_facility_conditional_post_request"}
          }
        }
      }
    },
    "organization_department_resource": {
      "object": {
        "fullUrl": {"const": "urn:uuid:61ebe121-aa02-0003-0001-983a382abcd7"},
        "resource": {
          "object": {
            "resourceType": {"const": "Organization"},
            "identifier": {
              "array": [
                {
                  "object": {
                    "system": {"const": "https://pediatrix.com/fhir/NamingSystem/facilityId-departmentId-id"},
                    "value": {"xpath": "PV1", "template": "transform_department_identifier"}
                  }
                }
              ]
            },
            "partOf": {
              "object": {
                "reference": {"const": "urn:uuid:61ebe121-aa02-0001-0001-983a382abcd7"}
              }
            },
            "name": {"xpath": "PV1/point_of_care"}
          }
        },
        "request": {
          "object": {
            "method": {"const": "POST"},
            "url": {"const": "Organization"},
            "ifNoneExist": {"xpath": "PV1", "template": "organization_department_conditional_post_request"}
          }
        }
      }
    },
    "patient_resource": {
      "object": {
        "fullUrl": {"const": "urn:uuid:61ebe121-aa01-0001-0001-983a382abcd7"},
        "resource": {
          "object": {
            "resourceType": {"const": "Patient"},
            "identifier": {
              "array": [
                {"xpath": ".[PID/mrn!='']",
                  "object": {
                    "system": {"const": "https://pediatrix.com/fhir/NamingSystem/mrn-id"},
                    "value": {"xpath": "PID/mrn"},
                    "assigner": {
                      "object": {
                        "reference": {"const": "urn:uuid:61ebe121-aa02-0001-0001-983a382abcd7"}
                      }
                    },
                    "type": {
                      "object": {
                        "coding": {
                          "array": [
                            {
                              "object": {
                                "system": {"const": "http://terminology.hl7.org/CodeSystem/v2-0203"},
                                "code": {"const": "MR"},
                                "display": {"const": "Medical Record Number"}
                              }
                            }
                          ]
                        }
                      }
                    }
                  }
                },
                {"xpath": ".[PID/ssn!='']",
                  "object": {
                    "system": {"const": "http://hl7.org/fhir/sid/us-ssn"},
                    "value": {"xpath": "PID/ssn", "template": "transform_ssn"},
                    "type": {
                      "object": {
                        "coding": {
                          "array": [
                            {
                              "object": {
                                "system": {"const": "http://terminology.hl7.org/CodeSystem/v2-0203"},
                                "code": {"const": "SS"},
                                "display": {"const": "Social Security Number"}
                              }
                            }
                          ]
                        }
                      }
                    }
                  }
                },
                {"xpath": ".[PID/hospital_patient_number!='']",
                  "object": {
                    "system": {"const": "https://pediatrix.com/fhir/NamingSystem/hospital-patient-id"},
                    "value": {"xpath": "PID/hospital_patient_number"},
                    "assigner": {
                      "object": {
                        "reference": {"const": "urn:uuid:61ebe121-aa02-0001-0001-983a382abcd7"}
                      }
                    },
                    "type": {
                      "object": {
                        "coding": {
                          "array": [
                            {
                              "object": {
                                "system": {"const": "http://terminology.hl7.org/CodeSystem/v2-0203"},
                                "code": {"const": "PI"},
                                "display": {"const": "Patient Internal Identifier"}
                              }
                            }
                          ]
                        }
                      }
                    }
                  }
                }
              ]
            },
            "name": {
              "array": [
                {
                  "object": {
                    "family": {"xpath": "PID/last_name"},
                    "given": {
                        "array": [
                            {"xpath": "PID/first_name"},
                            {"xpath": "PID/middle_name"}
                        ]
                    }
                  }
                }
              ]
            },
            "telecom": {
              "array": [
                {"xpath": ".[PID/home_phone!='']",
                  "object": {
                    "system": {"const": "phone"},
                    "value": {"xpath": "PID/home_phone"},
                    "use": {"xpath": "PID/home_phone_type", "template": "transform_phone_type"}
                  }
                },
                {"xpath": ".[PID/work_phone!='']",
                    "object": {
                      "system": {"const": "phone"},
                      "value": {"xpath": "PID/work_phone"},
                      "use": {"const": "work"}
                    }
                },
                {"xpath": ".[PID/home_email!='']",
                  "object": {
                    "system": {"const": "email"},
                    "value": {"xpath": "PID/home_email", "template": "transform_email_type"},
                    "use": {"const": "home"}
                  }
                },
                {"xpath": ".[PID/work_email!='']",
                  "object": {
                    "system": {"const": "email"},
                    "value": {"xpath": "PID/work_email", "template": "transform_email_type"},
                    "use": {"const": "work"}
                  }
                }
              ]
            },
            "gender": {"xpath": "PID/gender", "template": "transform_gender_code"},
            "birthDate": {"xpath": "PID/dob", "template": "transform_date"},
            "deceasedDateTime": {"xpath": "PID/date_of_death", "template": "transform_date"},
            "address": {
              "array": [
                {
                  "object": {
                    "use": {"xpath": "PID/address_type", "template": "transform_address_use"},
                    "type": {"const": "physical"},
                    "line": {
                        "array": [
                            {"xpath": "PID/address_1"},
                            {"xpath": "PID/address_2"}
                        ]
                    },
                    "city": {"xpath": "PID/city"},
                    "state": {"xpath": "PID/state"},
                    "postalCode": {"xpath": "PID/zip"},
                    "country": {"xpath": "PID/country"}
                  }
                }
              ]
            },
            "maritalStatus": {"xpath": ".[PID/marital_status!='']",
              "object": {
                "coding": {
                  "array": [
                    {   "xpath": "PID/marital_status",
                        "object": {
                            "system": {"const": "http://terminology.hl7.org/CodeSystem/v3-MaritalStatus"},
                            "code": {"template": "transform_marital_code"},
                            "display": {"template": "transform_marital_display"}
                        }
                    }
                  ]
                }
              }
            },
            "multipleBirthInteger": {"xpath": "PID/birth_order", "template": "transform_patient_birthorder"}
          }
        },
        "request": {
          "object": {
            "method": {"const": "PUT"},
            "url": {"template": "patient_put_request"}
          }
        }
      }
    },
    "encounter_resource": {
      "object": {
        "fullUrl": {"const": "urn:uuid:61ebe121-aa03-0001-0001-983a382abcd7"},
        "resource": {
          "object": {
            "resourceType": {"const": "Encounter"},
            "identifier": {
              "array": [
                {
                  "object": {
                    "system": {"const": "https://pediatrix.com/fhir/NamingSystem/patient-demographics-update-id"},
                    "value": {"xpath": "PV1", "template": "transform_encounter_identifier"}
                  }
                },
                {
                  "object": {
                    "system": {"const": "https://pediatrix.com/fhir/NamingSystem/pac-id"},
                    "value": {"const": "pacid123"}
                  }
                }
              ]
            },
            "status": {"const": "planned"},
            "class": {
              "object": {
                "system": {"const": "http://terminology.hl7.org/CodeSystem/v3-ActCode"},
                "code": {"const": "IMP"},
                "display": {"const": "inpatient encounter"}
              }
            },
            "subject": {
              "object": {
                "type": {"const": "Patient"},
                "reference": {"const":"urn:uuid:61ebe121-aa01-0001-0001-983a382abcd7"}
              }
            },
            "period": {
              "object": {
                "start": {"xpath": "PV1/admit_datetime", "template": "transform_datetime"},
                "end": {"xpath": "PV1/discharge_datetime", "template": "transform_datetime"}
              }
            },
            "serviceProvider": {"xpath": ".[PV1/point_of_care!='']", "_comment": "Note: Organization (department) reference only populated with existence of point of care",
              "object": {
                "reference": {"const": "urn:uuid:61ebe121-aa02-0003-0001-983a382abcd7"}
              }
            },
            "type": {
              "array": [
                {
                  "object": {
                    "text": {"xpath": "PV1", "template": "transform_encounter_types", "_comment": "Note: field is concatenation of 3 PV1 fields not easily mapped to FHIR"}
                  }
                }
              ]
            },
            "participant": {
              "array": [
                {"xpath": ".[PV1/attending_physician_id!='']",
                  "object": {
                    "type": {
                      "array":[
                        {
                          "object": {
                            "coding": {
                              "array": [
                                {
                                  "object": {
                                    "system": {"const": "http://terminology.hl7.org/CodeSystem/v3-ParticipationType"},
                                    "code": {"const": "ATND"},
                                    "display": {"const": "Attending"}
                                  }
                                }
                              ]
                            }
                          }
                        }
                      ]
                    },
                    "individual": {
                      "object": {
                        "type": {"const": "Practitioner"},
                        "reference": {"const": "urn:uuid:61ebe121-aa07-0001-0001-983a382abcd7"}
                      }
                    }
                  }
                },
                {"xpath": ".[PV1/referring_physician_id!='']",
                  "object": {
                    "type": {
                      "array":[
                        {
                          "object": {
                            "coding": {
                              "array": [
                                {
                                  "object": {
                                    "system": {"const": "http://terminology.hl7.org/CodeSystem/v3-ParticipationType"},
                                    "code": {"const": "REF"},
                                    "display": {"const": "Referring"}
                                  }
                                }
                              ]
                            }
                          }
                        }
                      ]
                    },
                    "individual": {
                      "object": {
                        "type": {"const": "Practitioner"},
                        "reference": {"const": "urn:uuid:61ebe121-aa07-0002-0001-983a382abcd7"}
                      }
                    }
                  }
                }
              ]
            },
            "account": {
                "array": [
                    {
                        "object": {
                            "type": {"const": "Account"},
                            "reference": {"const": "urn:uuid:61ebe121-aa04-0001-0001-983a382abcd7"}
                        }
                    }
                ]
            }
          }
        },
        "request": {
          "object": {
            "method": {"const": "POST"},
            "url": {"const": "Encounter"},
            "ifNoneExist": {"xpath": ".", "template": "encounter_conditional_post_request"}
          }
        }
      }
    },
    "account_resource": {
      "object": {
        "fullUrl": {"const": "urn:uuid:61ebe121-aa04-0001-0001-983a382abcd7"},
        "resource": {
          "object": {
            "resourceType": {"const": "Account"},
            "identifier": {
              "array": [
                {
                  "object": {
                    "system": {"const": "https://pediatrix.com/fhir/NamingSystem/patientAccount-id"},
                    "value": {"template": "concat_mrn_facility"}
                  }
                }
              ]
            },
            "status": {"const": "active"},
            "type": {
              "object": {
                "coding": {
                  "array": [
                    {
                      "object": {
                        "system": {"const": "http://terminology.hl7.org/CodeSystem/v3-ActCode"},
                        "code": {"const": "PBILLACCT"},
                        "display": {"const": "Patient Billing Account"}
                      }
                    }
                  ]
                }
              }
            },
            "subject": {
              "array": [
                {
                  "object": {
                    "type": {"const": "Patient"},
                    "reference": {"const": "urn:uuid:61ebe121-aa01-0001-0001-983a382abcd7"}
                  }
                }
              ]
            },
            "coverage": {
                "array": [
                    {"xpath": "insurance[position()=1]",
                        "object": {
                            "coverage": {
                                "object": {
                                    "reference": {"const": "urn:uuid:61ebe121-aa06-0001-0001-983a382abcd7"}
                                }
                            },
                            "priority": {"const": "1", "type": "int"}
                        }
                    },
                    {"xpath": "insurance[position()=2]",
                        "object": {
                            "coverage": {
                                "object": {
                                    "reference": {"const": "urn:uuid:61ebe121-aa06-0001-0002-983a382abcd7"}
                                }
                            },
                            "priority": {"const": "2", "type": "int"}
                        }
                    },
                    {"xpath": "insurance[position()=3]",
                        "object": {
                            "coverage": {
                                "object": {
                                    "reference": {"const": "urn:uuid:61ebe121-aa06-0001-0003-983a382abcd7"}
                                }
                            },
                            "priority": {"const": "3", "type": "int"}
                        }
                    }
                ]
            },
            "guarantor": {
              "array": [
                {"xpath": "guarantor[position()=1]",
                  "object": {
                    "party": {
                      "object": {
                        "type": {"const": "RelatedPerson"},
                        "reference": {"const": "urn:uuid:61ebe121-aa05-0001-0001-983a382abcd7"}
                      }
                    }
                  }
                }
              ]
            }
          }
        },
        "request": {
          "object": {
            "method": {"const": "PUT"},
            "url": {"template": "account_put_request"}
          }
        }
      }
    },
    "relatedperson_guarantor_resource": {
      "object": {
        "fullUrl": {
            "custom_func":{
                "name": "concat",
                "args": [
                    {"const": "urn:uuid:61ebe121-aa05-0001-000"},
                    {"xpath": "GT1/set_id"},
                    {"const": "-983a382abcd7"}
                ]
            }
        },
        "resource": {
          "object": {
            "resourceType": {"const": "RelatedPerson"},
            "identifier": {
              "array": [
                {
                  "object": {
                    "system": {"const": "https://pediatrix.com/fhir/NamingSystem/relatedPerson-id"},
                    "value": {"xpath": "GT1", "template": "transform_relatedperson_guarantor_identifier"}
                  }
                },
                {"xpath": ".[GT1/ssn!='']",
                  "object": {
                    "system": {"const": "http://hl7.org/fhir/sid/us-ssn"},
                    "value": {"xpath": "GT1/ssn", "template": "transform_ssn"},
                    "type": {
                      "object": {
                        "coding": {
                          "array": [
                            {
                              "object": {
                                "system": {"const": "https://terminology.hl7.org/5.0.0/CodeSystem-v2-0203"},
                                "code": {"const": "SS"},
                                "display": {"const": "Social Security Number"}
                              }
                            }
                          ]
                        }
                      }
                    }
                  }
                }
              ]
            },
            "name": {
            "array": [
                {
                "object": {
                    "family": {"xpath": "GT1/last_name"},
                    "given": {
                        "array": [
                            {"xpath": "GT1/first_name"},
                            {"xpath": "GT1/middle_name"}
                        ]
                    }
                }
                }
            ]
            },
            "patient": {
              "object": {
                "type": {"const": "Patient"},
                "reference": {"const": "urn:uuid:61ebe121-aa01-0001-0001-983a382abcd7"}
              }
            },
            "telecom": {
              "array": [
                {"xpath": ".[GT1/home_phone!='']",
                  "object": {
                    "system": {"const": "phone"},
                    "value": {"xpath": "GT1/home_phone"},
                    "use": {"xpath": "GT1/home_phone_type", "template": "transform_phone_type"}
                  }
                },
                {"xpath": ".[GT1/work_phone!='']",
                  "object": {
                    "system": {"const": "phone"},
                    "value": {"xpath": "GT1/work_phone"},
                    "use": {"const": "work"}
                  }
                },
                {"xpath": ".[GT1/home_email!='']",
                  "object": {
                    "system": {"const": "email"},
                    "value": {"xpath": "GT1/home_email", "template": "transform_email_type"},
                    "use": {"const": "home"}
                  }
                },
                {"xpath": ".[GT1/work_email!='']",
                  "object": {
                    "system": {"const": "email"},
                    "value": {"xpath": "GT1/work_email", "template": "transform_email_type"},
                    "use": {"const": "work"}
                  }
                }
              ]
            },
            "gender": {"xpath": "GT1/gender", "template": "transform_gender_code"},
            "birthDate": {"xpath": "GT1/dob", "template": "transform_date"},
            "address": {
                "array": [
                  {
                    "object": {
                      "use": {"xpath": "GT1/address_type", "template": "transform_address_use"},
                      "type": {"const": "physical"},
                      "line": {
                          "array": [
                              {"xpath": "GT1/address_1"},
                              {"xpath": "GT1/address_2"}
                          ]
                      },
                      "city": {"xpath": "GT1/city"},
                      "state": {"xpath": "GT1/state"},
                      "postalCode": {"xpath": "GT1/zip"},
                      "country": {"xpath": "GT1/country"}
                    }
                  }
                ]
            }
          }
        },
        "request": {
          "object": {
            "method": {"const": "PUT"},
            "url": {"xpath": "GT1", "template": "relatedperson_guarantor_put_request"}
          }
        }
      }
    },
    "relatedperson_subscriber_resource": {
      "object": {
        "fullUrl": {
            "custom_func":{
                "name": "javascript",
                "args": [
                    {"const": "prefix + index.toString() + suffix"},
                    {"const": "prefix"}, {"const": "urn:uuid:61ebe121-aa05-0002-000"},
                    {"const": "index"}, {"xpath": "IN1/set_id", "template": "transform_insurance_set_id"},
                    {"const": "suffix"}, {"const": "-983a382abcd7"}
                ]
            }
        },
        "resource": {
          "object": {
            "resourceType": {"const": "RelatedPerson"},
            "identifier": {
              "array": [
                {
                  "object": {
                    "system": {"const": "https://pediatrix.com/fhir/NamingSystem/relatedPerson-id"},
                    "value": {"xpath": "IN1", "template": "transform_insurance_identifier", "_comment": "insurance identifer value is also used as subscriber identifier value"}
                  }
                },
                {"xpath": ".[IN2/insured_ssn!='']",
                  "object": {
                    "system": {"const": "http://hl7.org/fhir/sid/us-ssn"},
                    "value": {"xpath": "IN2/insured_ssn", "template": "transform_ssn"},
                    "type": {
                      "object": {
                        "coding": {
                          "array": [
                            {
                              "object": {
                                "system": {"const": "https://terminology.hl7.org/5.0.0/CodeSystem-v2-0203"},
                                "code": {"const": "SS"},
                                "display": {"const": "Social Security Number"}
                              }
                            }
                          ]
                        }
                      }
                    }
                  }
                }
              ]
            },
            "name": {
            "array": [
                {
                  "object": {
                      "family": {"xpath": "IN1/insured_last_name"},
                      "given": {
                          "array": [
                              {"xpath": "IN1/insured_first_name"},
                              {"xpath": "IN1/insured_middle_name"}
                          ]
                      }
                  }
                }
            ]
            },
            "patient": {
              "object": {
                "type": {"const": "Patient"},
                "reference": {"const": "urn:uuid:61ebe121-aa01-0001-0001-983a382abcd7"}
              }
            },
            "telecom": {
              "array": [
                {"xpath": ".[IN2/insured_home_phone!='']",
                  "object": {
                    "system": {"const": "phone"},
                    "value": {"xpath": "IN2/insured_home_phone"},
                    "use": {"xpath": "IN2/insured_home_phone_type", "template": "transform_phone_type"}
                  }
                },
                {"xpath": ".[IN2/insured_work_phone!='']",
                  "object": {
                    "system": {"const": "phone"},
                    "value": {"xpath": "IN2/insured_work_phone"},
                    "use": {"const": "work"}
                  }
                },
                {"xpath": ".[IN2/insured_home_email!='']",
                  "object": {
                    "system": {"const": "email"},
                    "value": {"xpath": "IN2/insured_home_email", "template": "transform_email_type"},
                    "use": {"const": "home"}
                  }
                },
                {"xpath": ".[IN2/insured_work_email!='']",
                  "object": {
                    "system": {"const": "email"},
                    "value": {"xpath": "IN2/insured_work_email", "template": "transform_email_type"},
                    "use": {"const": "work"}
                  }
                }
              ]
            },
            "gender": {"xpath": "IN1/insured_gender", "template": "transform_gender_code"},
            "birthDate": {"xpath": "IN1/insured_dob", "template": "transform_date"},
            "address": {
                "array": [
                  {
                    "object": {
                      "use": {"xpath": "IN1/insured_address_type", "template": "transform_address_use"},
                      "type": {"const": "physical"},
                      "line": {
                          "array": [
                              {"xpath": "IN1/insured_address_1"},
                              {"xpath": "IN1/insured_address_2"}
                          ]
                      },
                      "city": {"xpath": "IN1/insured_city"},
                      "state": {"xpath": "IN1/insured_state"},
                      "postalCode": {"xpath": "IN1/insured_zip"},
                      "country": {"xpath": "IN1/insured_country"}
                    }
                  }
                ]
            }
          }
        },
        "request": {
          "object": {
            "method": {"const": "PUT"},
            "url": {"xpath": "IN1", "template": "relatedperson_subscriber_put_request"}
          }
        }
      }
    },
    "organization_payor_resource": {
      "object": {
        "fullUrl": {
            "custom_func":{
                "name": "javascript",
                "args": [
                    {"const": "prefix + index.toString() + suffix"},
                    {"const": "prefix"}, {"const": "urn:uuid:61ebe121-aa02-0002-000"},
                    {"const": "index"}, {"xpath": "IN1/set_id", "template": "transform_insurance_set_id"},
                    {"const": "suffix"}, {"const": "-983a382abcd7"}
                ]
            }
        },
        "resource": {
          "object": {
            "resourceType": {"const": "Organization"},
            "identifier": {
              "array": [
                {
                  "object": {
                    "system": {"const": "https://pediatrix.com/fhir/NamingSystem/payor-id"},
                    "value": {"xpath": "IN1", "template": "transform_insurance_identifier"}
                  }
                }
              ]
            },
            "name": {"xpath": "IN1/company_name"},
            "telecom": {
              "array": [
                {"xpath": ".[IN1/insurance_phone!='']",
                  "object": {
                    "system": {"const": "phone"},
                    "value": {"xpath": "IN1/insurance_phone"},
                    "use": {"const": "work"}
                  }
                }
              ]
            },
            "address": {
              "array": [
                {
                  "object": {
                    "use": {"xpath": "IN1/address_type", "template": "transform_address_use"},
                    "type": {"const": "physical"},
                    "line": {
                        "array": [
                            {"xpath": "IN1/address_1"},
                            {"xpath": "IN1/address_2"}
                        ]
                    },
                    "city": {"xpath": "IN1/city"},
                    "state": {"xpath": "IN1/state"},
                    "postalCode": {"xpath": "IN1/zip"},
                    "country": {"xpath": "IN1/country"}
                  }
                }
              ]
            }
          }
        },
        "request": {
          "object": {
            "method": {"const": "POST"},
            "url": {"const": "Organization"},
            "ifNoneExist": {"xpath": "IN1", "template": "organization_payor_conditional_post_request"}
          }
        }
      }
    },
    "coverage_resource": {
      "object": {
        "fullUrl": {
          "custom_func":{
            "name": "javascript",
            "args": [
              {"const": "prefix + index.toString() + suffix"},
              {"const": "prefix"}, {"const": "urn:uuid:61ebe121-aa06-0001-000"},
              {"const": "index"}, {"xpath": "IN1/set_id", "template": "transform_insurance_set_id"},
              {"const": "suffix"}, {"const": "-983a382abcd7"}
            ]
          }
        },
        "resource": {
          "object": {
            "resourceType": {"const": "Coverage"},
            "identifier": {
              "array": [
                {
                  "object": {
                    "system": {"const": "https://pediatrix.com/fhir/NamingSystem/coverage-id"},
                    "value": {"xpath": "IN1", "template": "transform_coverage_identifier"}
                  }
                },
                {
                  "object": {
                    "system": {"const": "https://pediatrix.com/fhir/NamingSystem/insurance-policy-id"},
                    "value": {"xpath": "IN1/policy_number"},
                    "type": {
                      "object": {
                        "coding": {
                          "array": [
                            {
                              "object": {
                                "system": {"const": "http://terminology.hl7.org/CodeSystem/v2-0203"},
                                "code": {"const": "MB"},
                                "display": {"const": "Member Number"}
                              }
                            }
                          ]
                        }
                      }
                    }
                  }
                }
              ]
            },
            "status": {"const": "active"},
            "policyHolder": {
                  "object": {
                    "reference": {"const": "urn:uuid:61ebe121-aa01-0001-0001-983a382abcd7"}
                }
            },
            "subscriber": {
              "object": {
                "type": {"xpath": "IN1", "template": "transform_coverage_subscriber_type"},
                "identifier": {
                    "object": {
                        "system": {"xpath": "IN1", "template": "transform_coverage_subscriber_system"},
                        "value": {"xpath": "IN1", "template": "transform_coverage_subscriber_identifier"}
                    }
                },
                "display": {"xpath": "IN1", "template": "transform_coverage_subscriber_display"},
                "reference": {
                    "custom_func": {
                      "name": "javascript",
                      "args": [
                        {"const": "ref_type == 'Patient' ? pat_urn : rel_urn "},
                        {"const": "ref_type"}, {"xpath": "IN1", "template": "transform_coverage_subscriber_type"},
                        {"const": "pat_urn"}, {"const": "urn:uuid:61ebe121-aa01-0001-0001-983a382abcd7"},
                        {"const": "rel_urn"}, {
                          "custom_func":{
                              "name": "javascript",
                              "args": [
                                  {"const": "prefix + index.toString() + suffix"},
                                  {"const": "prefix"}, {"const": "urn:uuid:61ebe121-aa05-0002-000"},
                                  {"const": "index"}, {"xpath": "IN1/set_id", "template": "transform_insurance_set_id"},
                                  {"const": "suffix"}, {"const": "-983a382abcd7"}
                              ]
                          }
                        }
                      ]
                    }
                }
              }
            },
            "beneficiary": {
              "object": {
                "type": {"const": "Patient"},
                "display": {"const": "Patient (Ins Policy Beneficiary)"},
                "reference": {"const": "urn:uuid:61ebe121-aa01-0001-0001-983a382abcd7"}
              }
            },
            "relationship": {
              "object": {
                "coding": {
                  "array": [
                    {
                      "object": {
                        "system": {"const": "http://terminology.hl7.org/CodeSystem/subscriber-relationship"},
                        "code": {"xpath": "IN1/insured_patient_relationship", "template": "transform_coverage_patient_relationship_code"},
                        "display": {"xpath": "IN1/insured_patient_relationship", "template": "transform_coverage_patient_relationship_display"}
                      }
                    }
                  ]
                }
              }
            },
            "period": {
              "object": {
                "start": {"xpath": "IN1/plan_effective_date", "template": "transform_datetime"},
                "end": {"xpath": "IN1", "template": "transform_coverage_expiration"}
              }
            },
            "payor": {
              "array":[
                {
                  "object": {
                    "reference": {
                        "custom_func":{
                            "name": "javascript",
                            "args": [
                                {"const": "prefix + index.toString() + suffix"},
                                {"const": "prefix"}, {"const": "urn:uuid:61ebe121-aa02-0002-000"},
                                {"const": "index"}, {"xpath": "IN1/set_id", "template": "transform_insurance_set_id"},
                                {"const": "suffix"}, {"const": "-983a382abcd7"}
                            ]
                        }
                    }
                  }
                }
              ]
            },
            "class": {"xpath": ".", "template": "coverage_class_conditional_display"},
            "order": {"xpath": "IN1/set_id", "template": "transform_insurance_set_id"},
            "network": {"xpath": "IN1/plan_type"}
          }
        },
        "request": {
          "object": {
            "method": {"const": "PUT"},
            "url": {"xpath": "IN1", "template": "coverage_put_request"}
          }
        }
      }
    },
    "claim_resource": {
      "object": {
        "fullUrl": {
          "custom_func":{
            "name": "javascript",
            "args": [
              {"const": "prefix + index.toString() + suffix"},
              {"const": "prefix"}, {"const": "urn:uuid:61ebe121-aa08-0001-000"},
              {"const": "index"}, {"xpath": "IN1/set_id", "template": "transform_insurance_set_id"},
              {"const": "suffix"}, {"const": "-983a382abcd7"}
            ]
          }
        },
        "resource": {
          "object": {
            "resourceType": {"const": "Claim"},
            "identifier": {
              "array": [
                {
                  "object": {
                    "system": {"const": "https://pediatrix.com/fhir/NamingSystem/claim-id"},
                    "value": {"xpath": "IN1", "template": "transform_insurance_identifier"}
                  }
                }
              ]
            },
            "status": {"const": "active"},
            "use": {"const": "preauthorization"},
            "type": {
              "object": {
                "coding": {
                  "array": [
                    {
                      "object": {
                        "system": {"const": "http://terminology.hl7.org/CodeSystem/claim-type"},
                        "code": {"const": "institutional"},
                        "display": {"const": "Institutional"}
                      }
                    }
                  ]
                }
              }
            },
            "created": {"template": "transform_current_datetime"},
            "patient": {
              "object": {
                "type": {"const": "Patient"},
                "reference": {"const":"urn:uuid:61ebe121-aa01-0001-0001-983a382abcd7"}
              }
            },
            "provider": {
              "object": {
                "type": {"const": "Organization"},
                "reference": {"const":"urn:uuid:61ebe121-aa02-0001-0001-983a382abcd7"}
              }
            },
            "priority": {
              "object": {
                "coding": {
                  "array": [
                    {
                      "object": {
                        "system": {"const": "http://terminology.hl7.org/CodeSystem/processpriority"},
                        "code": {"const": "normal"}
                      }
                    }
                  ]
                }
              }
            },
            "insurance": {
              "array": [{
                "object": {
                  "coverage": {
                    "object": {
                      "type": {"const": "Coverage"},
                      "reference": {
                          "custom_func":{
                          "name": "javascript",
                          "args": [
                            {"const": "prefix + index.toString() + suffix"},
                            {"const": "prefix"}, {"const": "urn:uuid:61ebe121-aa06-0001-000"},
                            {"const": "index"}, {"xpath": "IN1/set_id", "template": "transform_insurance_set_id"},
                            {"const": "suffix"}, {"const": "-983a382abcd7"}
                          ]
                        }
                      }
                    }
                  },
                  "focal": {"const": "true", "type": "boolean"},
                  "sequence": {"const": "1", "type": "int"},
                  "preAuthRef": {
                    "array": [
                      {"xpath": "IN1/auth_number"}
                    ]
                  }
                }
              }]
            }
          }
        },
        "request": {
          "object": {
            "method": {"const": "PUT"},
            "url": {"xpath": "IN1", "template": "claim_put_request"}
          }
        }
      }
    },
    "practitioner_attending_resource": {
      "object": {
          "fullUrl": {"const": "urn:uuid:61ebe121-aa07-0001-0001-983a382abcd7"},
          "resource": {
            "object": {
              "resourceType": {"const": "Practitioner"},
              "name": {
                "array": [
                  { "xpath": "PV1",
                    "object": {
                      "family": {"xpath": "attending_physician_last_name"},
                      "given": {
                          "array": [
                              {"xpath": "attending_physician_first_name"}
                          ]
                      }
                    }
                  }
                ]
              },
              "identifier": {
                  "array": [
                    {
                      "object": {
                        "type": {
                          "object": {
                            "coding": {
                              "array": [
                                {
                                  "object": {
                                    "system": {"const": "http://terminology.hl7.org/CodeSystem/v2-0203"},
                                    "code": {"const": "PRN"}
                                  }
                                }
                              ]
                            }
                          }
                        },
                        "system": {"const": "https://pediatrix.com/fhir/NamingSystem/us-npi-id"},
                        "value": {"xpath": "PV1", "template": "transform_attending_physician_identifier"}
                      }
                    },
                    {
                      "object": {
                        "system": {"const": "https://pediatrix.com/fhir/NamingSystem/npi-id"},
                        "value": {"xpath": "PV1/attending_physician_id"},
                        "type": {
                          "object": {
                            "coding": {
                              "array": [
                                {
                                  "object": {
                                    "system": {"const": "http://terminology.hl7.org/CodeSystem/v2-0203"},
                                    "code": {"const": "NPI"},
                                    "display": {"const": "National Provider Identifier"}
                                  }
                                }
                              ]
                            }
                          }
                        }
                      }
                    }
                  ]
                }
            }
          },
          "request": {
            "object": {
              "method": {"const": "POST"},
              "url": {"const": "Practitioner"},
              "ifNoneExist": {"xpath": "PV1", "template": "practitioner_attending_post_request"}
            }
          }
      }
    },
    "practitioner_referring_resource": {
      "object": {
          "fullUrl": {"const": "urn:uuid:61ebe121-aa07-0002-0001-983a382abcd7"},
          "resource": {
            "object": {
              "resourceType": {"const": "Practitioner"},
              "name": {
                "array": [
                  { "xpath": "PV1",
                    "object": {
                      "family": {"xpath": "referring_physician_last_name"},
                      "given": {
                          "array": [
                              {"xpath": "referring_physician_first_name"}
                          ]
                      }
                    }
                  }
                ]
              },
              "identifier": {
                 "array": [
                      {
                          "object": {
                              "type": {
                              "object": {
                                  "coding": {
                                    "array": [
                                      {
                                        "object": {
                                          "system": {"const": "http://terminology.hl7.org/CodeSystem/v2-0203"},
                                          "code": {"const": "PRN"}
                                        }
                                      }
                                    ]
                                  }
                              }
                              },
                              "system": {"const": "https://pediatrix.com/fhir/NamingSystem/us-npi-id"},
                              "value": {"xpath": "PV1", "template": "transform_referring_physician_identifier"}
                          }
                      },
                      {
                        "object": {
                          "system": {"const": "https://pediatrix.com/fhir/NamingSystem/npi-id"},
                          "value": {"xpath": "PV1/referring_physician_id"},
                          "type": {
                            "object": {
                              "coding": {
                                "array": [
                                  {
                                    "object": {
                                      "system": {"const": "http://terminology.hl7.org/CodeSystem/v2-0203"},
                                      "code": {"const": "NPI"},
                                      "display": {"const": "National Provider Identifier"}
                                    }
                                  }
                                ]
                              }
                            }
                          }
                        }
                      }
                 ]
              }
            }
          },
          "request": {
            "object": {
              "method": {"const": "POST"},
              "url": {"const": "Practitioner"},
              "ifNoneExist": {"xpath": "PV1", "template": "practitioner_referring_post_request"}
            }
          }
        }
    },
    "transform_marital_code": {
        "custom_func": {
            "name": "javascript",
            "args": [
                {"const": "if (val) {switch(val.substring(0,1).toUpperCase()) {case 'M': 'M'; break; case 'S': 'U'; break; case 'D': 'D'; break; default: ''};} else {''}"},
                {"const": "val"}, {"xpath": "."}
            ]
        }
    },
    "transform_marital_display": {
        "custom_func": {
            "name": "javascript",
            "args": [
                {"const": "if (val) {switch(val.substring(0,1).toUpperCase()) {case 'M': 'Married'; break; case 'S': 'Unmarried'; break; case 'D': 'Divorced'; break; default: ''};} else {''}"},
                {"const": "val"}, {"xpath": "."}
            ]
        }
    },
    "transform_coverage_subscriber_system": {
        "custom_func": {
            "name": "javascript",
            "args": [
                {"const": "if (val) {switch(val.toUpperCase()) {case 'SELF':case 'S':case '01':case 'SP':case 'SE': 'https://pediatrix.com/fhir/NamingSystem/mrn-id'; break; default: 'https://pediatrix.com/fhir/NamingSystem/relatedPerson-id'};} else {'https://pediatrix.com/fhir/NamingSystem/mrn-id'}"},
                {"const": "val"}, {"xpath": "insured_patient_relationship"}
            ]
        }
    },
    "transform_coverage_subscriber_display": {
        "custom_func": {
            "name": "javascript",
            "args": [
                {"const": "'Subscriber (' + val + ')'"},
                {"const": "val"}, {"xpath": ".", "template": "transform_coverage_subscriber_type"}
            ]
        }
    },
    "transform_coverage_subscriber_type": {
        "custom_func": {
            "name": "javascript",
            "args": [
                {"const": "if (val) {switch(val.toUpperCase()) {case 'SELF':case 'S':case '01':case 'SP':case 'SE': 'Patient'; break; default: 'RelatedPerson'};} else {'Patient'}"},
                {"const": "val"}, {"xpath": "insured_patient_relationship"}
            ]
        }
    },
    "transform_patient_birthorder": {
        "custom_func": {
            "name": "javascript",
            "args": [
                {"const": "val ? parseInt(val) : ''"},
                {"const": "val"}, {"xpath": "."}
            ]
        }
    },
    "transform_ssn": {
        "custom_func": {
            "name": "javascript",
            "args": [
              {"const": "val ? '999999999' : ''"},
                {"const": "val"}, {"xpath": "."}
            ]
        }
    },
    "transform_coverage_subscriber_identifier": {
        "custom_func": {
            "name": "javascript",
            "args": [
                {"const": "if (val) {switch(val.toUpperCase()) {case 'SELF':case 'S':case '01':case 'SP':case 'SE': mrnfacility; break; default: subscriberid};} else {mrnfacility}"},
                {"const": "val"}, {"xpath": "insured_patient_relationship"},
                {"const": "subscriberid"}, {"xpath": ".", "template": "transform_insurance_identifier"},
                {"const": "mrnfacility"}, {"xpath": "../..", "template": "concat_mrn_facility", "_comment": "IN1 passed in, navigate to root so PID can be referenced"}
            ]
        }
    },
    "transform_coverage_codeable": {
        "array": [
            {
              "object": {
                "value": {"xpath": "/IN1/group_number"},
                "type": {
                  "object": {
                    "coding": {
                      "array": [
                        {
                          "object": {
                            "system": {"const": "http://terminology.hl7.org/CodeSystem/coverage-class"},
                            "code": {"const": "group"},
                            "display": {"const": "Group"}
                          }
                        }
                      ]
                    }
                  }
                }
              }
            }
          ]
    },
    "transform_coverage_patient_relationship_code": {
      "custom_func": {
          "name": "javascript",
          "args": [
              {"const": "if (val) {switch(val.toUpperCase()) {case 'MOTHER':case 'FATHER':case 'MOT':case 'FAT':case 'MTHR':case 'FTHR':case 'PARENT':case 'F':case 'M': 'child'; break; case 'SELF':case 'S':case '01':case 'SP':case 'SE': 'self'; break; case 'SPOUSE':case '02': 'spouse'; break; case 'CHILD':case 'CH': 'other'; break; default: 'other'};} else {'other'}"},
              {"const": "val"}, {"xpath": "."}
          ]
      }
    },
    "transform_coverage_patient_relationship_display": {
      "custom_func": {
          "name": "javascript",
          "args": [
              {"const": "if (val) {switch(val.toUpperCase()) {case 'MOTHER':case 'FATHER':case 'MOT':case 'FAT':case 'MTHR':case 'FTHR':case 'PARENT':case 'F':case 'M': 'Child'; break; case 'SELF':case 'S':case '01':case 'SP':case 'SE': 'Self'; break; case 'SPOUSE':case '02': 'Spouse'; break; case 'CHILD':case 'CH': 'Other'; break; default: 'Other'};} else {'Other'}"},
              {"const": "val"}, {"xpath": "."}
          ]
      }
    },
    "transform_gender_code": {
        "custom_func": {
            "name": "javascript",
            "args": [
                {"const": "if (val) {switch(val.substring(0,1).toUpperCase()) {case 'M': 'male'; break; case 'F': 'female'; break; default: 'unknown'};} else {'unknown'}"},
                {"const": "val"}, {"xpath": "."}
            ]
        }
    },
    "transform_date": {
        "custom_func": {
            "name": "javascript",
            "args": [
                {"const": "dt===null ? '' : dt.substring(0,10);"},
                {"const": "dt"},{
                    "custom_func": {
                        "name": "dateTimeToRFC3339",
                        "args": [
                            { "xpath": "." },
                            { "const": "", "_comment": "fromTZ" },
                            { "const": "", "_comment": "toTZ" }
                        ]
                    }
                }
            ]
        }
    },
    "transform_current_datetime": {
        "custom_func": {
            "name": "javascript",
            "args": [
                {"const": "new Date()"}
            ]
        }
    },
    "transform_datetime": {
        "custom_func": {
            "name": "javascript",
            "args": [
                {"const": "dt===null ? '' : dt.substring(0,10);"},
                {"const": "dt"},{
                    "custom_func": {
                        "name": "dateTimeToRFC3339",
                        "args": [
                            { "xpath": "." },
                            { "const": "", "_comment": "fromTZ" },
                            { "const": "", "_comment": "toTZ" }
                        ]
                    }
                }
            ]
        }
    },
    "transform_coverage_expiration": {
      "custom_func": {
          "name": "javascript",
          "args": [
              {"const": "enddate ? (!startdate && !enddate) || enddate < startdate ? '' : enddate : ''"},
              {"const": "enddate"}, {"xpath": "plan_expiration_date", "template": "transform_datetime"},
              {"const": "startdate"}, {"xpath": "plan_effective_date", "template": "transform_datetime"}
          ]
      }
    },
    "transform_insurance_set_id": {
      "custom_func": {
          "name": "javascript",
          "args": [
              {"const": "setid ? parseInt(setid) : tertiary ? 3 : secondary ? 2 : 1"},
              {"const": "secondary"}, {"xpath": "../../IN1[count(..//insurance/preceding-sibling::insurance)=1]"},
              {"const": "tertiary"}, {"xpath": "../../IN1[count(..//insurance/preceding-sibling::insurance)=2]"},
              {"const": "setid"}, {"xpath": "."}
          ]
      }
    },
    "transform_guarantor_set_id": {
      "custom_func": {
          "name": "javascript",
          "args": [
              {"const": "setid ? parseInt(setid) : tertiary ? 3 : secondary ? 2 : 1"},
              {"const": "secondary"}, {"xpath": "../../GT1[count(..//guarantor/preceding-sibling::guarantor)=1]"},
              {"const": "tertiary"}, {"xpath": "../../GT1[count(..//guarantor/preceding-sibling::guarantor)=2]"},
              {"const": "setid"}, {"xpath": "."}
          ]
      }
    },
    "transform_encounter_identifier": {
        "custom_func": {
            "name": "javascript",
            "args": [
                {"const": "!admitdate ? mrnfacility : mrnfacility + '-' + admitdate.replace(/-/g,'')"},
                {"const": "admitdate"}, {"xpath": "admit_datetime", "template": "transform_datetime"},
                {"const": "mrnfacility"}, {"xpath": "..", "template": "concat_mrn_facility"}
            ]
        }
    },
    "transform_encounter_types": {
      "custom_func": {
        "name": "concat",
        "args": [
          { "xpath": "admit_type" },
          { "const": "|" },
          { "xpath": "patient_type" },
          { "const": "|" },
          { "xpath": "financial_class" }
        ]
      }
    },
    "transform_department_identifier": {
        "custom_func": {
            "name": "javascript",
            "args": [
              {"const": "!dept || dept == '' ? mrnfacility + '-PV1-' + setid.toString() : mrnfacility + '-' + encodeURIComponent(dept).replace(/\\%[A-F0-9]{2}/g,'')"},
                {"const": "dept"}, {"xpath": "point_of_care"},
                {"const": "setid"}, {"xpath": "set_id"},
                {"const": "mrnfacility"}, {"xpath": "..", "template": "concat_mrn_facility"}
            ]
        }
    },
    "transform_insurance_identifier": {
        "custom_func": {
            "name": "javascript",
            "args": [
                {"const": "!planid || planid == '' ? mrnfacility + '-IN1-' + setid.toString() : mrnfacility + '-' + encodeURIComponent(planid).replace(/\\%[A-F0-9]{2}/g,'')"},
                {"const": "planid"}, {"xpath": "plan_id"},
                {"const": "setid"}, {"xpath": "set_id", "template": "transform_insurance_set_id"},
                {"const": "mrnfacility"}, {"xpath": "../..", "template": "concat_mrn_facility", "_comment": "IN1 passed in, navigate to root so PID can be referenced"}
            ]
        }
    },
    "transform_coverage_identifier": {
        "custom_func": {
            "name": "javascript",
            "args": [
                {"const": "!policy_number || policy_number == '' ? mrnfacility + '-IN1-' + setid.toString() : mrnfacility + '-' + encodeURIComponent(policy_number).replace(/\\%[A-F0-9]{2}/g,'')"},
                {"const": "policy_number"}, {"xpath": "policy_number"},
                {"const": "setid"}, {"xpath": "set_id", "template": "transform_insurance_set_id"},
                {"const": "mrnfacility"}, {"xpath": "../..", "template": "concat_mrn_facility", "_comment": "IN1 passed in, navigate to root so PID can be referenced"}
            ]
        }
    },
    "transform_attending_physician_identifier": {
        "custom_func": {
            "name": "javascript",
            "args": [
                {"const": "!npi || npi == '' ? mrnfacility + '-PV1-' + idtype : mrnfacility + '-' + encodeURIComponent(npi).replace(/\\%[A-F0-9]{2}/g,'')"},
                {"const": "npi"}, {"xpath": "attending_physician_id"},
                {"const": "idtype"}, {"const": "ATND"},
                {"const": "mrnfacility"}, {"xpath": "..", "template": "concat_mrn_facility"}
            ]
        }
    },
    "transform_referring_physician_identifier": {
        "custom_func": {
            "name": "javascript",
            "args": [
                {"const": "!npi || npi == '' ? mrnfacility + '-PV1-' + idtype : mrnfacility + '-' + encodeURIComponent(npi).replace(/\\%[A-F0-9]{2}/g,'')"},
                {"const": "npi"}, {"xpath": "referring_physician_id"},
                {"const": "idtype"}, {"const": "REF"},
                {"const": "mrnfacility"}, {"xpath": "..", "template": "concat_mrn_facility"}
            ]
        }
    },
    "transform_address_use": {
        "custom_func": {
            "name": "javascript",
            "args": [
                {"const": "if (val) {switch(val.toUpperCase()) {case 'P': 'home'; break; case 'H': 'home'; break; case 'M': 'billing'; break; case 'O': 'work'; break; default: ''};} else {'';}"},
                {"const": "val"}, {"xpath": "."}
            ]
        }
    },
    "transform_phone_type": {
        "custom_func": {
            "name": "javascript",
            "args": [
                {"const": "if (val) {switch(val.toUpperCase()) {case 'CP': 'mobile'; break; default: 'home'};} else {'home'}"},
                {"const": "val"}, {"xpath": "."}
            ]
        }
    },
    "transform_email_type": {
        "custom_func": {
            "name": "javascript",
            "args": [
                {"const": "if (val && val.includes('@')) {val;} else {''}"},
                {"const": "val"}, {"xpath": "."}
            ]
        }
    },
    "transform_message_header_focus": {
      "custom_func": {
          "name": "javascript",
          "args": [
              {"const": "if (val) {'urn:uuid:61ebe121-aa03-0001-0001-983a382abcd7';} else {'urn:uuid:61ebe121-aa01-0001-0001-983a382abcd7';}"},
              {"const": "val"}, {"xpath": ".[count(PV1)=1]"}
          ]
      }
    },
    "transform_message_header_identifier": {
      "custom_func": {
          "name": "concat",
          "args": [
              { "const": "MessageHeader?control-id=" },
              { "template": "transform_message_header_control_id" }
          ]
      }
    },
    "transform_message_header_control_id": {
        "custom_func": {
            "name": "concat",
            "args": [
                { "xpath": "MSH/message_control_id" },
                { "xpath": "PID/mrn" },
                { "xpath": "MSH/datetime_of_message" }
            ]
        }
    },
    "transform_relatedperson_guarantor_identifier": {
      "custom_func": {
          "name": "javascript",
          "args": [
            {"const": "!guarantornumber || guarantornumber == '' ? mrnfacility + '-GT1-' + setid.toString() : mrnfacility + '-' + encodeURIComponent(guarantornumber).replace(/\\%[A-F0-9]{2}/g,'')"},
            {"const": "guarantornumber"}, {"xpath": "guarantor_number"},
            {"const": "setid"}, {"xpath": "set_id", "template": "transform_guarantor_set_id"},
            {"const": "mrnfacility"}, {"xpath": "../..", "template": "concat_mrn_facility"}
          ]
      }
    },
    "transform_relatedperson_subscriber_identifier": {
      "custom_func": {
          "name": "javascript",
          "args": [
            {"const": "!planid || planid == '' ? mrnfacility + '-IN1-' + setid.toString() : mrnfacility + '-' + encodeURIComponent(planid).replace(/\\%[A-F0-9]{2}/g,'')"},
            {"const": "planid"}, {"xpath": "plan_id"},
            {"const": "setid"}, {"xpath": "set_id", "template": "transform_insurance_set_id"},
            {"const": "mrnfacility"}, {"xpath": "../..", "template": "concat_mrn_facility"}
          ]
      }
    },
    "encounter_conditional_post_request": {
      "custom_func": {
          "name": "concat",
          "args": [
              { "const": "identifier=https://pediatrix.com/fhir/NamingSystem/patient-demographics-update-id|" },
              {"xpath": "PV1", "template": "transform_encounter_identifier" }
          ]
      }
    },
    "patient_put_request": {
      "custom_func": {
          "name": "concat",
          "args": [
              { "const": "Patient?identifier=https://pediatrix.com/fhir/NamingSystem/mrn-id|" },
              { "xpath": "PID/mrn" },
              { "const": "&mrn-assigner=urn:uuid:61ebe121-aa02-0001-0001-983a382abcd7" }
          ]
      }
    },
    "relatedperson_guarantor_put_request": {
      "custom_func": {
          "name": "concat",
          "args": [
              { "const": "RelatedPerson?identifier=https://pediatrix.com/fhir/NamingSystem/relatedPerson-id|" },
              { "xpath": ".", "template": "transform_relatedperson_guarantor_identifier" }
          ]
      }
    },
    "relatedperson_subscriber_put_request": {
      "custom_func": {
          "name": "concat",
          "args": [
              { "const": "RelatedPerson?identifier=https://pediatrix.com/fhir/NamingSystem/relatedPerson-id|" },
              { "xpath": ".", "template": "transform_relatedperson_subscriber_identifier" }
          ]
      }
    },
    "organization_facility_conditional_post_request": {
      "custom_func": {
          "name": "concat",
          "args": [
              { "const": "identifier=https://pediatrix.com/fhir/NamingSystem/facilityId-id|" },
              { "const": "{{FacilityId}}" }
          ]
      }
    },
    "organization_department_conditional_post_request": {
      "custom_func": {
          "name": "concat",
          "args": [
              { "const": "identifier=https://pediatrix.com/fhir/NamingSystem/facilityId-departmentId-id|" },
              {"xpath": ".", "template": "transform_department_identifier" }
          ]
      }
    },
    "organization_payor_conditional_post_request": {
      "custom_func": {
          "name": "concat",
          "args": [
              {"const": "identifier=https://pediatrix.com/fhir/NamingSystem/payor-id|" },
              {"xpath": ".", "template": "transform_insurance_identifier" }
          ]
      }
    },
    "coverage_put_request": {
      "custom_func": {
          "name": "concat",
          "args": [
              { "const": "Coverage?identifier=https://pediatrix.com/fhir/NamingSystem/coverage-id|" },
              { "xpath": ".", "template": "transform_coverage_identifier" }
          ]
      }
    },
    "claim_put_request": {
      "custom_func": {
          "name": "concat",
          "args": [
              { "const": "Claim?identifier=https://pediatrix.com/fhir/NamingSystem/claim-id|" },
              { "xpath": ".", "template": "transform_insurance_identifier" }
          ]
      }
    },
    "account_put_request": {
      "custom_func": {
          "name": "concat",
          "args": [
              { "const": "Account?identifier=https://pediatrix.com/fhir/NamingSystem/patientAccount-id|" },
              { "template": "concat_mrn_facility" }
          ]
      }
    },
    "practitioner_attending_post_request":{
      "custom_func": {
          "name": "concat",
          "args": [
              { "const": "identifier=https://pediatrix.com/fhir/NamingSystem/us-npi-id|" },
              { "xpath": ".", "template": "transform_attending_physician_identifier" }
          ]
      }
    },
    "practitioner_referring_post_request":{
      "custom_func": {
          "name": "concat",
          "args": [
              { "const": "identifier=https://pediatrix.com/fhir/NamingSystem/us-npi-id|" },
              { "xpath": ".", "template": "transform_referring_physician_identifier" }
          ]
      }
    },
    "concat_mrn_facility": {
      "custom_func": {
          "name": "concat",
          "args": [
              { "xpath": "PID/mrn" },
              { "const": "-{{FacilityId}}" }
          ]
      }
    },
    "coverage_class_conditional_display": {
      "custom_func": {
          "name": "javascript",
          "args": [
              {"const": "group_number !== null ? transform_coverage_codeable : ''"},
              {"const": "transform_coverage_codeable"}, {"template": "transform_coverage_codeable"},
              {"const": "group_number"}, {"xpath": "IN1/group_number"}
          ]
      }
    }
  }
}